import { Errno, ErrnoError } from '@zenfs/core';
let framebufferN = 0;
/**
 * A frame buffer
 *
 * Setup:
 * ```
 * addDevice(framebuffer, { canvas: document.querySelector('#your-canvas') })
 * ```
 */
export const framebuffer = {
    name: 'framebuffer',
    init(ino, { canvas } = {}) {
        if (!canvas) {
            canvas = document.createElement('canvas');
            document.body.appendChild(canvas);
        }
        const ctx = canvas.getContext('2d');
        if (!ctx) {
            throw new ErrnoError(Errno.EIO, 'Could not get context from canvas whilst initializing frame buffer.');
        }
        return { data: ctx, major: 29, minor: framebufferN++, name: 'fb' };
    },
    read() {
        return 0;
    },
    write(file, data) {
        const { width, height } = file.device.data.canvas;
        if (data.byteLength < 4 * width * height) {
            return 0;
        }
        const imageData = new ImageData(new Uint8ClampedArray(data), width, height);
        file.device.data.putImageData(imageData, 0, 0);
        return data.byteLength;
    },
};
