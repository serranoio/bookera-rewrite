{
  "version": 3,
  "sources": ["../../@pb33f/saddlebag/dist/saddlebag.js"],
  "sourcesContent": ["const e = \"bags\", b = \"saddlebag\";\nclass g {\n  _bags;\n  _stateful;\n  _db;\n  constructor(s) {\n    this._bags = /* @__PURE__ */ new Map(), this._stateful = s;\n  }\n  loadStatefulBags() {\n    return new Promise((s) => {\n      const t = indexedDB.open(b, 1);\n      t.onupgradeneeded = () => {\n        this._db = t.result, this._db.createObjectStore(e);\n      }, t.onsuccess = () => {\n        if (this._db = t.result, this._db) {\n          const a = this._db.transaction(e).objectStore(e).openCursor();\n          a.onsuccess = (c) => {\n            let r = c.target.result;\n            if (r) {\n              let h = r.primaryKey, l = r.value;\n              const _ = this.createBag(h);\n              _.populate(l), this._bags.set(h, _), r.continue();\n            } else\n              s({ db: this._db });\n          };\n        }\n      };\n    });\n  }\n  get db() {\n    return this._db ? this._db : null;\n  }\n  createBag(s) {\n    const t = d(s, this._stateful);\n    return t.db = this._db, this._bags.set(s, t), t;\n  }\n  getBag(s) {\n    return this._bags.has(s) ? this._bags.get(s) : this.createBag(s);\n  }\n  resetBags() {\n    this._bags.forEach((s) => {\n      s.reset();\n    });\n  }\n}\nlet u;\nfunction p(n) {\n  return u || (u = new g(n || !1)), u;\n}\nfunction S() {\n  return p();\n}\nfunction d(n, s) {\n  return new f(n, s);\n}\nclass o {\n  _allChangesBit;\n  _key;\n  _subFunction;\n  _allChangesFunction;\n  _populatedFunction;\n  _bag;\n  constructor(s, t) {\n    this._bag = s, this._allChangesBit = t, this._key = \"\", this._subFunction = void 0, this._allChangesFunction = void 0, this._populatedFunction = void 0;\n  }\n  set allChangeFunction(s) {\n    this._allChangesFunction = s;\n  }\n  set populatedFunction(s) {\n    this._populatedFunction = s;\n  }\n  set subscriptionFunction(s) {\n    this._subFunction = s;\n  }\n  set key(s) {\n    this._key = s;\n  }\n  unsubscribe() {\n    switch (this._allChangesBit) {\n      case 0:\n        const s = this._bag._subscriptions.get(this._key);\n        s && this._bag._subscriptions.set(\n          this._key,\n          s.filter((t) => t !== this._subFunction)\n        );\n        break;\n      case 1:\n        this._bag._allChangesSubscriptions = this._bag._allChangesSubscriptions.filter((t) => t !== this._allChangesFunction);\n        break;\n      case 2:\n        this._bag._storePopulatedSubscriptions = this._bag._storePopulatedSubscriptions.filter((t) => t !== this._populatedFunction);\n    }\n  }\n}\nclass f {\n  _id;\n  _stateful;\n  _values;\n  _db;\n  _subscriptions;\n  _allChangesSubscriptions;\n  _storePopulatedSubscriptions;\n  constructor(s, t) {\n    this._values = /* @__PURE__ */ new Map(), this._subscriptions = /* @__PURE__ */ new Map(), this._allChangesSubscriptions = [], this._storePopulatedSubscriptions = [], this._stateful = t || !1, this._id = s;\n  }\n  set(s, t) {\n    this._values.set(s, structuredClone(t)), this.alertSubscribers(s, t), this._stateful && this._db && this._db.transaction([e], \"readwrite\").objectStore(e).put(this._values, this._id);\n  }\n  get id() {\n    return this._id;\n  }\n  set db(s) {\n    this._db = s;\n  }\n  reset() {\n    this._values.forEach((s, t) => {\n      this.alertSubscribers(t, void 0);\n    }), this._values = /* @__PURE__ */ new Map(), this._stateful && this._db && this._db.transaction([e], \"readwrite\").objectStore(e).delete(this._id);\n  }\n  alertSubscribers(s, t) {\n    this._subscriptions.has(s) && this._subscriptions.get(s)?.forEach(\n      (i) => i(t)\n    ), this._allChangesSubscriptions.length > 0 && this._allChangesSubscriptions.forEach(\n      (i) => i(s, t)\n    );\n  }\n  get(s) {\n    return this._values.get(s);\n  }\n  populate(s) {\n    s && s.size > 0 && (this._values = structuredClone(s), this._storePopulatedSubscriptions.length > 0 && this._storePopulatedSubscriptions.forEach(\n      (t) => t(s)\n    ));\n  }\n  export() {\n    return this._values;\n  }\n  subscribe(s, t) {\n    if (!this._subscriptions.has(s))\n      this._subscriptions.set(s, [t]);\n    else {\n      const a = this._subscriptions.get(s);\n      a && this._subscriptions.set(s, [...a, t]);\n    }\n    const i = new o(this, 0);\n    return i.key = s, i.subscriptionFunction = t, i;\n  }\n  onAllChanges(s) {\n    this._allChangesSubscriptions.push(s);\n    const t = new o(this, 1);\n    return t.allChangeFunction = s, t;\n  }\n  onPopulated(s) {\n    this._storePopulatedSubscriptions.push(s);\n    const t = new o(this, 2);\n    return t.populatedFunction = s, t;\n  }\n}\nexport {\n  b as BAG_DB_NAME,\n  e as BAG_OBJECT_STORE,\n  o as BagSubscription,\n  d as CreateBag,\n  p as CreateBagManager,\n  S as GetBagManager\n};\n"],
  "mappings": "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",
  "names": []
}
